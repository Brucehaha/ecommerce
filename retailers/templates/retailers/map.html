{% extends "base.html" %}
{% block title %}map{% endblock%}
{% block css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>

{% endblock %}
{% block js %}
<script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js" integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q==" crossorigin=""></script>
<script>
$(document).ready(function(){
    var url='/retailers/RetailerMapAjax/';
    var method='GET';
    $.ajax({
        url:url,
        method:method,
        success: function(responseData){
            console.log(responseData.business[0]['location']);
            const business = responseData.business;
            renderMap(business)
        },
        errer: function(error){
            $.alert("An error occured")
        }
    })
});
const renderMap = (business) => {
    var grayscaleUrl = 'http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png';
    var streetsUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    var list = [];
    for (i=0; i < business.length; i++) {
        var location = business[i]['location'];
        var name = business[i]['name'];
        var count = business[i]['count'];
        var samples = business[i]['samples'];
        list.push(L
            .marker(location)
            .bindPopup('<h4>'+name+'</h4>'+''+'No.: '+count+'<br />'+'Samples: '+samples.join(' | '))
        )

    }
    // var tfc = L.marker([-37.746243, 145.0041753]).bindPopup('This is GD flooring');
    // var gfc = L.marker(location).bindPopup('This is Goldenfield, CO.'+location);

    var Melbourne = L.layerGroup(list);

    var grayscale = L.tileLayer(grayscaleUrl, {id: 'MapID'}),
        streets   = L.tileLayer(streetsUrl, {id: 'MapID'});

    var mymap = L.map('mapid', {
        center: [-37.8136, 144.9631],
        zoom: 10,
        layers: [grayscale, Melbourne],
        attributionControl: false,
    });

    var baseMaps = {
        "<span style='color: gray'>Grayscale</span>": grayscale,
        "Streets": streets
    };
    //
    var overlayMaps = {
        "Cities": Melbourne
    };

    L.control.layers(baseMaps, overlayMaps).addTo(mymap);

}


 // var mymap = L.map('mapid').setView([-37.8136, 144.9631], 10);
 // L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png').addTo(mymap);
// var tfc = L.marker([-37.746243, 145.0041753]).addTo(mymap).bindPopup('This is GD Flooring');
// var gfc = L.marker([-37.7167725, 144.9826217]).addTo(mymap).bindPopup('This is Goldenfield');


 </script>
{% endblock %}

{% block map %}
<div class="my-1 mx" id="mapid" style="height:680px;"></div>
{% endblock %}
